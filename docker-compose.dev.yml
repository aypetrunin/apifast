services:
  apifast:
    build: .
    image: "zena_apifast:${ENV}"
    env_file:
      - ../deploy/dev.env
    ports:
      - "${APIFAST_PORT}:3024"
    volumes:
      - ./src:/app/src
      - ./pyproject.toml:/app/pyproject.toml
      - ./uv.lock:/app/uv.lock
    restart: unless-stopped
    networks:
      - zena-network
    healthcheck:
      test: ["CMD-SHELL", "python -c \"import socket; s=socket.socket(); s.settimeout(1); s.connect(('127.0.0.1',3024)); s.close()\""]
      interval: 5s
      timeout: 2s
      retries: 30
      start_period: 10s

